#!/bin/bash   

collect_info() {
  echo
  echo "========================================"
  echo "Текущий рабочий каталог:"
  pwd  # pwd — выводит путь текущего рабочего каталога

  echo ""
  echo "========================================"
  echo ""
  echo "Текущий запущенный процесс:"
  ps -p $$  # ps — отображает процессы; -p — по PID; $$ — PID текущего скрипта

  echo ""
  echo "========================================"
  echo ""
  echo "Домашний каталог:"
  echo $HOME  # $HOME — переменная окружения: путь к домашнему каталогу текущего пользователя

  echo ""
  echo "========================================"
  echo ""
  echo "Название и версия ОС:"
  uname -s -r  # uname — информация о системе; -s — имя ОС; -r — версия ядра

  echo ""
  echo "========================================"
  echo ""
  echo "Доступные оболочки в системе:"
  cat /etc/shells  # cat — выводит содержимое файла; /etc/shells — список допустимых оболочек

  echo ""
  echo "========================================"
  echo ""
  echo "Текущие пользователи в системе:"
  who  # who — показывает список вошедших в систему пользователей

  echo ""
  echo "========================================"
  echo ""
  echo "Количество вошедших пользователей:"
  who | wc -l  # who — список пользователей; wc -l — посчитать количество строк (то есть пользователей)

  echo ""
  echo "========================================"
  echo ""
  echo "Информация о жестких дисках:"
  df -h  # df — информация о дисковом пространстве; -h — в человекочитаемом формате (GB, MB)

  echo ""
  echo "========================================"
  echo ""
  echo "Информация о процессоре:"
  lscpu  # lscpu — показывает детальную информацию о процессоре

  echo ""
  echo "========================================"
  echo ""
  echo "Информация о памяти:"
  free -m  # free — объём памяти; -m — показать в мегабайтах

  echo ""
  echo "========================================"
  echo ""
  echo "Информация о файловой системе:"
  lsblk  # lsblk — выводит дерево блочных устройств: дисков, разделов и т.д.

  echo ""
  echo "========================================"
  echo ""
  echo "Информация об установленных пакетах ПО:"
  apt-mark showmanual  # apt-mark showmanual — список вручную установленных пакетов APT
  echo ""
  echo "========================================"
}

if [[ "$1" == "--tofile" && -n "$2" ]]; then  
  collect_info >"$2"  
  echo "Информация сохранена в файл $2"
  exit 0 
fi

while true; do
  clear  # clear — очистить экран терминала
  echo "Меню системной информации:"
  echo "1.  Текущий рабочий каталог"
  echo "2.  Текущий запущенный процесс"
  echo "3.  Домашний каталог"
  echo "4.  Название и версия ОС"
  echo "5.  Доступные оболочки в системе"
  echo "6.  Текущие пользователи в системе"
  echo "7.  Количество вошедших пользователей"
  echo "8.  Информация о жестких дисках"
  echo "9.  Информация о процессоре"
  echo "10. Информация о памяти"
  echo "11. Информация о файловой системе"
  echo "12. Информация об установленных пакетах ПО"
  echo "13. Вывести всю информацию"
  echo "14. Выход"
  read -p "Введите номер опции: " choice  # read -p — выводит сообщение и считывает ввод в переменную choice

  case $choice in
  1)
    echo ""
    echo "Текущий рабочий каталог:"
    pwd  # pwd — путь к текущей директории
    echo ""
    ;;
  2)
    echo ""
    echo "Текущий запущенный процесс:"
    ps -p $$  # ps -p $$ — процесс текущего скрипта
    echo ""
    ;;
  3)
    echo ""
    echo "Домашний каталог:"
    echo $HOME  # путь к домашнему каталогу
    echo ""
    ;;
  4)
    echo ""
    echo "Название и версия ОС:"
    uname -s -r  # uname -s — имя ОС; -r — версия ядра
    echo ""
    ;;
  5)
    echo ""
    echo "Доступные оболочки в системе:"
    cat /etc/shells  # список поддерживаемых оболочек
    echo ""
    ;;
  6)
    echo ""
    echo "Текущие пользователи в системе:"
    who  # список вошедших пользователей
    echo ""
    ;;
  7)
    echo ""
    echo "Количество вошедших пользователей:"
    who | wc -l  # количество вошедших пользователей
    echo ""
    ;;
  8)
    echo ""
    echo "Информация о жестких дисках:"
    df -h  # использование дисков (в человекочитаемом виде)
    echo ""
    ;;
  9)
    echo ""
    echo "Информация о процессоре:"
    lscpu  # информация о CPU
    echo ""
    ;;
  10)
    echo ""
    echo "Информация о памяти:"
    free -m  # свободная/занятая память в мегабайтах
    echo ""
    ;;
  11)
    echo ""
    echo "Информация о файловой системе:"
    lsblk  # структура блочных устройств
    echo ""
    ;;
  12)
    echo ""
    echo "Информация об установленных пакетах ПО:"
    apt-mark showmanual  # вручную установленные пакеты
    echo ""
    ;;
  13)
    echo ""
    echo "Вывод всей информации:"
    collect_info  # вызов всей функции сбора информации
    echo ""
    ;;
  14)
    echo ""
    echo "ВЫХОД"
    exit 0  # выход из скрипта
    ;;
  *)
    echo ""
    echo "Неверный выбор! Попробуйте снова."
    echo ""
    ;;
  esac

  read -p "Для продолжения нажмите Enter"  # пауза перед следующим показом меню
done
